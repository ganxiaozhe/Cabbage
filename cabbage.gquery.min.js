/* Cabbage.gQuery.js v0.1.0 | (c) 2020, JU Chengren (Ganxiaozhe) | gquery.net/plugins/cabbage */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){if(!$||!gQuery)throw new Error("Cabbage.js need gQuery: https://gquery.net/");var e={i:{},dataToHtml:function(t){var a={sel:window.getSelection().toString()||""};return e.i.selText=a.sel,a.html=t.reduce(function(e,t,n){return t.break?e+"<li class='break'></li>":t.selection&&!a.sel?e+"":(a.text=t.text.replace(/\[\:sel\]/g,a.sel).substr(0,32),t.disable?e+"<li class='disable'>"+a.text+"</li>":(a.cls=["i"],"object"==_typeof(t.data)&&a.cls.push("extra"),e+"<li class='"+a.cls.join(" ")+"' data-i='"+n+"'>"+a.text+"</li>"))},""),a.html},posHandle:function(e,t){var a={winW:window.innerWidth,winH:window.innerHeight,menuW:e.offsetWidth,menuH:e.offsetHeight,eX:t.pageX,eY:t.pageY,margin:10},n={top:0,left:0};return a.winH+=0==document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,a.x=a.menuW+a.eX+a.margin,a.y=a.menuH+a.eY+a.margin,n.top=a.eY+a.margin,n.left=a.eX+a.margin,a.x>=a.winW&&a.y>=a.winH?(n.top=a.eY-a.menuH-a.margin,n.left=a.eX-a.menuW-a.margin):a.x>=a.winW?n.left=a.eX-a.menuW-a.margin:a.y>=a.winH&&(n.top=a.eY-a.menuH-a.margin),n},liHandle:function(e){var t={menu:$(e).parent().parent(),trigger:$(".cabbage-active"),idx:$(e).attr("data-i")};return"cabbageMenu"!=t.menu.attr("id")?t.data=t.menu.data("cabbageMenu"):t.data=t.trigger.data("cabbageMenu"),t},extraMenuClear:function(){setTimeout(function(){e.i.extra>0||(clearTimeout(e.i.emDelay),$("#cabbageMenu1").remove())},50)}};$.fn.extend({cabbage:function(t){"object"===(void 0===t?"undefined":_typeof(t))&&Array.isArray(t)&&this.data({cabbageMenu:t}),this.on("contextmenu",function(t){t.preventDefault(),this.classList.add("cabbage-active");var a={obj:$(this),html:""};if(a.data=a.obj.data("cabbageMenu"),!a.data)return!1;a.html="<div id='cabbageMenu' class='cabbageMenu'><ul>"+e.dataToHtml(a.data)+"</ul></div>",$(".cabbageMenu").remove(),$("body").append(a.html),a.pos=e.posHandle($("#cabbageMenu")[0],t),$("#cabbageMenu").css({top:a.pos.top+"px",left:a.pos.left+"px"}),$(document).off("click",{flag:"cabbageMenu"}).off("contextmenu",{flag:"cabbageMenu"}).on({click:function(){$(".cabbage-active").removeClass("cabbage-active"),$(".cabbageMenu").remove()},contextmenu:function(){$(".cabbage-active").removeClass("cabbage-active"),$(".cabbageMenu").remove()}},{flag:"cabbageMenu"})})}}),$(document).on("click",".cabbageMenu ul li",function(){var t=e.liHandle(this);if(void 0===t.idx)return!1;t.func=t.data[t.idx].func,t.opts={selText:e.i.selText},"function"==typeof t.func&&t.func.call(t.trigger[0],t.opts)},{flag:"Always"}),$(document).on({mouseover:function(){var t=$(this);if(t.hasClass("i")){if($("#cabbageMenu1").length>0)return void e.i.extra++;e.i.extra=1,e.i.emDelay=setTimeout(function(){var a=e.liHandle(t);if(!a.data)return void console.log("[Cabbage.js] empty menu data.");a.extra=a.data[a.idx].data,a.html="<div id='cabbageMenu1' class='cabbageMenu extra'><ul>"+e.dataToHtml(a.extra)+"</ul></div>",a.pos=t.offset(!0),a.pos.top-=8,a.pos.left+=t.width()+1,$("body").append(a.html),$("#cabbageMenu1").css({top:a.pos.top+"px",left:a.pos.left+"px"}).on({mouseenter:function(){e.i.extra++},mouseleave:function(){e.i.extra--,e.extraMenuClear()}}).data("cabbageMenu",a.extra)},500)}},mouseleave:function(){e.i.extra--,e.extraMenuClear()}},".cabbageMenu ul li.extra")}();