/* Cabbage.gQuery.js v0.1.0 | (c) 2020, JU Chengren (Ganxiaozhe) | gquery.net/plugins/cabbage */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){if(!$||!gQuery)throw new Error("Cabbage.js need gQuery: https://gquery.net/");var e={i:{},dataToHtml:function(e){var a={sel:window.getSelection().toString()||""};return a.html=e.reduce(function(e,t,n){return t.break?e+"<li class='break'></li>":t.selection&&!a.sel?e+"":(a.text=t.text.replace(/\[\:sel\]/g,a.sel).substr(0,32),t.disable?e+"<li class='disable'>"+a.text+"</li>":(a.cls=["i"],"object"==_typeof(t.data)&&a.cls.push("extra"),e+"<li class='"+a.cls.join(" ")+"' data-i='"+n+"'>"+a.text+"</li>"))},""),a.html},posHandle:function(e,a){var t={winW:window.innerWidth,winH:window.innerHeight,menuW:e.offsetWidth,menuH:e.offsetHeight,eX:a.pageX,eY:a.pageY,margin:10},n={top:0,left:0};return t.winH+=0==document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,t.x=t.menuW+t.eX+t.margin,t.y=t.menuH+t.eY+t.margin,n.top=t.eY+t.margin,n.left=t.eX+t.margin,t.x>=t.winW&&t.y>=t.winH?(n.top=t.eY-t.menuH-t.margin,n.left=t.eX-t.menuW-t.margin):t.x>=t.winW?n.left=t.eX-t.menuW-t.margin:t.y>=t.winH&&(n.top=t.eY-t.menuH-t.margin),n},liHandle:function(e){var a={menu:$(e).parent().parent(),trigger:$(".cabbage-active"),idx:$(e).attr("data-i")};return"cabbageMenu"!=a.menu.attr("id")?a.data=a.menu.data("cabbageMenu"):a.data=a.trigger.data("cabbageMenu"),a},extraMenuClear:function(){setTimeout(function(){e.i.extra>0||(clearTimeout(e.i.emDelay),$("#cabbageMenu1").remove())},50)}};$.fn.extend({cabbage:function(a){"object"===(void 0===a?"undefined":_typeof(a))&&Array.isArray(a)&&this.data({cabbageMenu:a}),this.on("contextmenu",function(a){a.preventDefault(),this.classList.add("cabbage-active");var t={obj:$(this),html:""};if(t.data=t.obj.data("cabbageMenu"),!t.data)return!1;t.html="<div id='cabbageMenu' class='cabbageMenu'><ul>"+e.dataToHtml(t.data)+"</ul></div>",$(".cabbageMenu").remove(),$("body").append(t.html),t.pos=e.posHandle($("#cabbageMenu")[0],a),$("#cabbageMenu").css({top:t.pos.top+"px",left:t.pos.left+"px"}),$(document).off("click",{flag:"cabbageMenu"}).off("contextmenu",{flag:"cabbageMenu"}).on({click:function(){$(".cabbage-active").removeClass("cabbage-active"),$(".cabbageMenu").remove()},contextmenu:function(){$(".cabbage-active").removeClass("cabbage-active"),$(".cabbageMenu").remove()}},{flag:"cabbageMenu"})})}}),$(document).on("click",".cabbageMenu ul li",function(){var a=e.liHandle(this);if(void 0===a.idx)return!1;a.func=a.data[a.idx].func,"function"==typeof a.func&&a.func.call(a.trigger[0])},{flag:"Always"}),$(document).on({mouseover:function(){var a=$(this);if(a.hasClass("i")){if($("#cabbageMenu1").length>0)return void e.i.extra++;e.i.extra=1,e.i.emDelay=setTimeout(function(){var t=e.liHandle(a);if(!t.data)return void console.log("[Cabbage.js] empty menu data.");t.extra=t.data[t.idx].data,t.html="<div id='cabbageMenu1' class='cabbageMenu extra'><ul>"+e.dataToHtml(t.extra)+"</ul></div>",t.pos=a.offset(!0),t.pos.top-=8,t.pos.left+=a.width()+1,$("body").append(t.html),$("#cabbageMenu1").css({top:t.pos.top+"px",left:t.pos.left+"px"}).on({mouseenter:function(){e.i.extra++},mouseleave:function(){e.i.extra--,e.extraMenuClear()}}).data("cabbageMenu",t.extra)},500)}},mouseleave:function(){e.i.extra--,e.extraMenuClear()}},".cabbageMenu ul li.extra")}();